<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mapping threats at sea to marine birds throughout their annual cycle to inform conservation and management in Atlantic Canada - 4&nbsp; Threat layers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./2_data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./3_threats.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Threat layers</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Mapping threats at sea to marine birds throughout their annual cycle to inform conservation and management in Atlantic Canada</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_research_compendium.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Research compendium</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Sources Overview</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_threats.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Threat layers</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#marine-pollution-incidents" id="toc-marine-pollution-incidents" class="nav-link active" data-scroll-target="#marine-pollution-incidents"><span class="header-section-number">4.1</span> Marine pollution incidents</a></li>
  <li><a href="#offshore-petroleum-activities" id="toc-offshore-petroleum-activities" class="nav-link" data-scroll-target="#offshore-petroleum-activities"><span class="header-section-number">4.2</span> Offshore petroleum activities</a>
  <ul class="collapse">
  <li><a href="#installations-wells-and-lease-areas" id="toc-installations-wells-and-lease-areas" class="nav-link" data-scroll-target="#installations-wells-and-lease-areas"><span class="header-section-number">4.2.1</span> Installations, wells, and lease areas</a></li>
  <li><a href="#flaring" id="toc-flaring" class="nav-link" data-scroll-target="#flaring"><span class="header-section-number">4.2.2</span> Flaring</a></li>
  <li><a href="#monthly-layers" id="toc-monthly-layers" class="nav-link" data-scroll-target="#monthly-layers"><span class="header-section-number">4.2.3</span> Monthly Layers</a></li>
  </ul></li>
  <li><a href="#offshore-wind-farms" id="toc-offshore-wind-farms" class="nav-link" data-scroll-target="#offshore-wind-farms"><span class="header-section-number">4.3</span> Offshore Wind Farms</a></li>
  <li><a href="#marine-vessel-traffic" id="toc-marine-vessel-traffic" class="nav-link" data-scroll-target="#marine-vessel-traffic"><span class="header-section-number">4.4</span> Marine vessel traffic</a>
  <ul class="collapse">
  <li><a href="#sec-shipping_threat" id="toc-sec-shipping_threat" class="nav-link" data-scroll-target="#sec-shipping_threat"><span class="header-section-number">4.4.1</span> Disturbance and pollution</a></li>
  <li><a href="#ship-based-light-pollution" id="toc-ship-based-light-pollution" class="nav-link" data-scroll-target="#ship-based-light-pollution"><span class="header-section-number">4.4.2</span> Ship-based light pollution</a></li>
  </ul></li>
  <li><a href="#coastal-light-pollution" id="toc-coastal-light-pollution" class="nav-link" data-scroll-target="#coastal-light-pollution"><span class="header-section-number">4.5</span> Coastal light pollution</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Threat layers</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="marine-pollution-incidents" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="marine-pollution-incidents"><span class="header-section-number">4.1</span> Marine pollution incidents</h2>
<p>The objective was to identify areas with relatively higher frequencies of past petroleum release incidents over a defined period. Such areas may also be at higher risk of future incidents, assuming high incident frequencies may be associated with factors such as high vessel traffic or fueling locations. Ideally, a more detailed approach would be used which incorporates spill diffusion modelling based on factors such as total volume, substance type, and local or regional currents to estimate the likely spread of each event. However, this level of detail was beyond the scope of the current study. Given the retrospective nature of the dataset and its focus on historical rather than predictive risk, we chose a simplified approach. Each recorded or probable incident was treated as an individual, discrete event in the dataset to characterize exposure to petroleum-related incidents.</p>
<p>This threat layer was constructed using the <a href="@sec-istop">ISTOP</a>, <a href="@sec-neec">NEEC</a>, and <a href="@sec-nasp">NASP</a> datasets. Each dataset was processed to create spatially and temporally explicit threat layers:</p>
<ul>
<li><strong>ISTOP</strong>: Categories 1A (possible oil with a clearly associated target), 1B (possible oil with a target within 50 km), and 2 (possible oil without an identifiable source) were retained. The ISTOP data already included polygons representing areas of exposure, which were directly utilized as pollution events in the analysis.</li>
<li><strong>NASP</strong>: Records with missing coordinates were removed. We inferred exposure areas for each NASP incident, initially represented as a point with latitude/longitude coordinates and spill volumes in liters, by categorizing spill volumes and applying a variable buffer around each point based on the reported volume (<a href="#tbl-spillvolumes" class="quarto-xref">Table&nbsp;<span>4.1</span></a>).</li>
<li><strong>NEEC</strong>: This dataset underwent extensive filtering, including the removal of records with empty coordinates, selection of the highest quantity category for multi-substance spills, exclusion of terms irrelevant to the marine environment (e.g., “mvi,” “furnace oil”), and filtering out observations beyond 1 km of the coastline. NEEC incidents were also represented as points with latitude/longitude coordinates and spill volumes in liters, had exposure areas inferred by categorizing spill volumes and applying a variable buffer around each point based on the reported volume (<a href="#tbl-spillvolumes" class="quarto-xref">Table&nbsp;<span>4.1</span></a>), with additional classification by substance type based on chemical state and the presence of an oil sheen.</li>
</ul>
<p>Each dataset was clipped to the boundary of the area of interest (<a href="index.html#sec-aoi" class="quarto-xref"><span>Section 1.3</span></a>). Temporal information was standardized, with incident dates grouped by month. The datasets were rasterized using the study grid, with each grid cell representing the count of overlapping incidents for a given month divided by the number of years covered by each dataset. This resulted in incident density units of number of events per year for each calendar month. For the NEEC dataset, threat layers were created for each substance classification (e.g., liquid with oil sheen, liquid without oil sheen, unknown). We also created monthly rasters combining all the NEEC, ISTOP, and NASP datasets together. The resulting rasters provide spatially explicit representations of petrole</p>
<ul>
<li><strong>Processing Scripts</strong>:
<ul>
<li><code>ana_petroleum_pollution_incidents_istop.R</code></li>
<li><code>ana_petroleum_pollution_incidents_nasp.R</code></li>
<li><code>ana_petroleum_pollution_incidents_neec.R</code></li>
<li><code>ana_petroleum_pollution_incidents.R</code></li>
</ul></li>
<li><strong>Output Files</strong>: Rasterized layers stored in <code>workspace/data/analyzed/petroleum_pollution_incidents-1.0.0/</code>.</li>
<li><strong>Units</strong>: Number of incidents / month</li>
<li><strong>Temporal</strong>: Monthly</li>
<li><strong>Years</strong>: 2006-2023</li>
</ul>
<div class="cell">
<div id="tbl-spillvolumes" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-spillvolumes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.1: Volume categories and buffer size selected to transform incident as point locations to area of exposure from
</figcaption>
<div aria-describedby="tbl-spillvolumes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Volume (L)</th>
<th style="text-align: right;">Buffer size (m)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">[0, 100]</td>
<td style="text-align: right;">250</td>
</tr>
<tr class="even">
<td style="text-align: left;">[100, 1000]</td>
<td style="text-align: right;">500</td>
</tr>
<tr class="odd">
<td style="text-align: left;">[1000, 10000]</td>
<td style="text-align: right;">1000</td>
</tr>
<tr class="even">
<td style="text-align: left;">[10000+ [</td>
<td style="text-align: right;">2000</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="offshore-petroleum-activities" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="offshore-petroleum-activities"><span class="header-section-number">4.2</span> Offshore petroleum activities</h2>
<section id="installations-wells-and-lease-areas" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="installations-wells-and-lease-areas"><span class="header-section-number">4.2.1</span> Installations, wells, and lease areas</h3>
<p>The offshore petroleum activity threat layers were developed to enable assessment of spatial exposure to exploration, resource delineation, and production activities, as well as potential future activity, within the defined study area. This analysis integrates spatial data on petroleum industry operations from Newfoundland <a href="2_data.html#sec-offshore_petroleum_nfl" class="quarto-xref"><span>Section 3.2.1</span></a> and Nova Scotia <a href="2_data.html#sec-offshore_petroleum_ns" class="quarto-xref"><span>Section 3.2.2</span></a>. Data preparation involved processing point (installations, wells) and polygon features (lease areas, sectors) from the harvested datasets. Point geometries were buffered by 500 meters to approximate their spatial influence, while polygon geometries were used as-is. It must be noted that the buffer size was selected only to represent the spatial presence of offshore petroleum activities rather than the risk that they pose in case of accidental oil spills. The combined dataset was clipped to the boundary of the area of interest. Activities were classified into distinct categories based on their classification (e.g., production, exploration, discovery; <a href="2_data.html#tbl-classifications" class="quarto-xref">Table&nbsp;<span>3.2</span></a>), operational status (e.g., active, abandoned; <a href="2_data.html#tbl-status" class="quarto-xref">Table&nbsp;<span>3.3</span></a>), and subtype (e.g., oil producer, gas injector; <a href="2_data.html#tbl-offshore-petroleum-subtypes" class="quarto-xref">Table&nbsp;<span>3.4</span></a>). The classification system ensures clear distinctions between current, past, and potential future activities where that information is available (see <a href="#tbl-offshore-petroleum-categories" class="quarto-xref">Table&nbsp;<span>4.2</span></a>). Finally, union operations were applied to consolidate overlapping geometries and identify areas of presence or absence for petroleum activities. To quantify exposure, the threat layers were rasterized using the study grid (<a href="index.html#sec-aoi" class="quarto-xref"><span>Section 1.3</span></a>). Each cell in the raster represents the count of overlapping features for a given combination of the categories presented above (<a href="#tbl-offshore-petroleum-categories" class="quarto-xref">Table&nbsp;<span>4.2</span></a>). This process generated a series of spatially explicit raster layers, which were exported as geospatial files for further use.</p>
<ul>
<li><strong>Processing Script</strong>: <code>ana_offshore_petroleum_activity.R</code></li>
<li><strong>Output File(s)</strong>: Rasterized layers stored in <code>workspace/data/analyzed/offshore_petroleum_activity-1.0.0/</code>.</li>
<li><strong>Units</strong>: Presence / absence</li>
<li><strong>Years</strong>: 1966-2032</li>
<li><strong>Temporal</strong>: No temporality</li>
</ul>
<div class="cell">
<div id="tbl-offshore-petroleum-categories" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-offshore-petroleum-categories-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.2: Categorization of Offshore Petroleum Activities
</figcaption>
<div aria-describedby="tbl-offshore-petroleum-categories-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Future Scope</td>
<td style="text-align: left;">Areas designated for future petroleum activities, such as call for bids and sector planning.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Current Oil Production</td>
<td style="text-align: left;">Active oil production sites, including oil wells, oil producers, and oil and gas wells currently operating or under development.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Past Oil Production</td>
<td style="text-align: left;">Previously active oil production sites that are now abandoned, suspended, closed, or off station.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Current Non-Oil Production</td>
<td style="text-align: left;">Active non-oil production sites, including gas wells, injectors, and other operations not classified as oil production.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Past Non-Oil Production</td>
<td style="text-align: left;">Previously active non-oil production sites that are now abandoned, suspended, closed, or off station.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Current Production Licenses</td>
<td style="text-align: left;">Licenses granted for current production activities, covering active lease areas.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Current Discovery</td>
<td style="text-align: left;">Currently active discovery and delineation sites undergoing exploration drilling or development.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Past Discovery</td>
<td style="text-align: left;">Past discovery sites that are no longer active.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Current Significant Discovery Licenses</td>
<td style="text-align: left;">Licenses granted for significant discoveries with current recognized potential.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Current Exploration</td>
<td style="text-align: left;">Active exploration activities, including drilling and operational exploratory wells.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Past Exploration</td>
<td style="text-align: left;">Exploration sites that are no longer active (abandoned, suspended, closed, or off station).</td>
</tr>
<tr class="even">
<td style="text-align: left;">Current Exploration Licenses</td>
<td style="text-align: left;">Licenses granted for current exploration activities.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Past Exploration Licenses</td>
<td style="text-align: left;">Licenses previously granted for exploration activities that are no longer active.</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="flaring" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="flaring"><span class="header-section-number">4.2.2</span> Flaring</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Atlantic scale
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This threat layer was also prepared at the scale of the whole Atlantic, <em>i.e.</em> in bounding box <code>longitude min: -97; latitude min: -54; longitude max: 49, latitude max: 66.5</code> in epsg:4326.</p>
</div>
</div>
</div>
<p>The offshore petroleum flaring threat layers were created using the VIIRS Night Fire (VNF) dataset (<a href="2_data.html#sec-viirs_night_fire" class="quarto-xref"><span>Section 3.5.2</span></a>), with separate analyses for monthly and annual data. These layers quantify spatial and temporal variations in flaring activity associated with offshore petroleum platforms, providing insight into their environmental footprint and potential risk to seabirds sensitive to light pollution.</p>
<section id="annual-layers" class="level4" data-number="4.2.2.1">
<h4 data-number="4.2.2.1" class="anchored" data-anchor-id="annual-layers"><span class="header-section-number">4.2.2.1</span> Annual Layers</h4>
<p>The annual VNF dataset was used to generate rasterized layers summarizing flaring activity by year. Each annual dataset contains spatial information on flaring platform locations, including the average temperature of flares (<code>avg_temp_k</code>) and the detection frequency (<code>detection_frequency</code>). The following steps were applied to create the annual threat layers:</p>
<ol type="1">
<li><strong>Data Preparation</strong>: The annual VNF dataset was filtered to retain only records within the area of interest (<a href="index.html#sec-aoi" class="quarto-xref"><span>Section 1.3</span></a>).</li>
<li><strong>Aggregation</strong>: Flaring activity was grouped by year to calculate annual summaries of total heat output (<code>total_heat</code>) and total detection frequencies (<code>detection_frequency</code>) at each platform location.</li>
<li><strong>Rasterization</strong>: The annual flaring data was rasterized using the study grid, with each grid cell containing the sum of <code>total_heat</code> and <code>detection_frequency</code> values for all platforms in that cell for a given year.</li>
<li><strong>Export</strong>: Rasterized layers were exported as geospatial files, with one raster file generated for each year.</li>
</ol>
<p>The resulting layers provide annual snapshots of flaring activity for comparison across years.</p>
<ul>
<li><strong>Processing Script</strong>: <code>ana_offshore_petroleum_platform_annual.R</code></li>
<li><strong>Output Files</strong>: Rasterized annual layers stored in <code>workspace/data/analyzed/offshore_petroleum_platform_annual-1.0.0/</code>.</li>
<li><strong>Units</strong>:
<ul>
<li>Total heat in Kelvin</li>
<li>Detection frequency as sum of percent detection frequency</li>
</ul></li>
<li><strong>Years</strong>: 2017-2023</li>
<li><strong>Temporal</strong>: Annual</li>
</ul>
</section>
</section>
<section id="monthly-layers" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="monthly-layers"><span class="header-section-number">4.2.3</span> Monthly Layers</h3>
<p>The monthly VNF dataset was used to generate high-resolution temporal layers, summarizing flaring activity at a monthly level. These layers provide finer granularity in monitoring platform activity. Only data from November 2023 to September 2024 were are available at the time of this project. The following steps were applied to create the monthly threat layers:</p>
<ol type="1">
<li><strong>Data Preparation</strong>: The monthly VNF dataset was filtered to retain only records flagged as <code>likely_flare</code> and located within the area of interest (<a href="index.html#sec-aoi" class="quarto-xref"><span>Section 1.3</span></a>).</li>
<li><strong>Temporal Grouping</strong>: Flaring activity was grouped by month, with the <code>total_heat</code> value aggregated for each month.</li>
<li><strong>Rasterization</strong>: For each month, flaring data was rasterized onto the study grid, with cell values representing the sum of <code>total_heat</code> values for all platforms within that cell.</li>
<li><strong>Export</strong>: Rasterized layers were exported as geospatial files, with one raster file generated for each month.</li>
</ol>
<p>The monthly layers allow for detailed temporal analyses of flaring activity, allowing for seasonal comparisons for species with variable intra-annual distributions such as aerofauna.</p>
<ul>
<li><strong>Processing Script</strong>: <code>ana_offshore_petroleum_platform_monthly.R</code></li>
<li><strong>Output Files</strong>: Rasterized monthly layers stored in <code>workspace/data/analyzed/offshore_petroleum_platform_monthly-1.0.0/</code>.</li>
<li><strong>Units</strong>: Total heat in Kelvin</li>
<li><strong>Years</strong>: November 2023 - September 2024</li>
<li><strong>Temporal</strong>: Monthly</li>
</ul>
</section>
</section>
<section id="offshore-wind-farms" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="offshore-wind-farms"><span class="header-section-number">4.3</span> Offshore Wind Farms</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Atlantic scale
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This threat layer was also prepared at the scale of the whole Atlantic, <em>i.e.</em> in bounding box <code>longitude min: -97; latitude min: -54; longitude max: 49, latitude max: 66.5</code> in epsg:4326.</p>
</div>
</div>
</div>
<p>The offshore wind farm threat layers were developed to assess the spatial footprint of existing and proposed offshore wind farms or area of interest for wind farm projects. This layer integrates data from multiple regional datasets, capturing offshore wind farm activity across Canada and the United States. More precisely, our analysis used offshore wind farm datasets for Canada (<a href="2_data.html#sec-offshore_wind_can" class="quarto-xref"><span>Section 3.3.1</span></a>) and the United-States (<a href="2_data.html#sec-offshore_wind_usa" class="quarto-xref"><span>Section 3.3.4</span></a>). Each dataset contains spatial information on the locations of wind farms represented as polygons. Activities were classified into distinct categories based on the BOEM classification (e.g., leases and turbine locations; <a href="2_data.html#tbl-wind-usa-classification" class="quarto-xref">Table&nbsp;<span>3.5</span></a>). We further categorized the BOEM classification to obtain four individual categories, i.e.&nbsp;current wind farms, transmission infrastructure, future development areas, and environmental monitoring (<a href="#tbl-offshore-wind-categories" class="quarto-xref">Table&nbsp;<span>4.3</span></a>). Point and line geometries were buffered by 500 meters to approximate their spatial influence, while polygon geometries were used as-is. Union operations were applied to consolidate overlapping geometries and identify areas of presence or absence for wind farm activities. To quantify exposure, the threat layers were rasterized using the study grid (<a href="index.html#sec-aoi" class="quarto-xref"><span>Section 1.3</span></a>). Each cell in the raster represents the count of overlapping features for a given combination of the categories presented above (<a href="#tbl-offshore-petroleum-categories" class="quarto-xref">Table&nbsp;<span>4.2</span></a>). This process generated a series of spatially explicit raster layers, which were exported as geospatial files for further use.</p>
<ul>
<li><strong>Processing Script</strong>: <code>ana_offshore_wind_farm.R</code></li>
<li><strong>Output File</strong>: Rasterized layers stored in <code>workspace/data/analyzed/offshore_wind_farm-1.0.0/</code>.</li>
<li><strong>Units</strong>: presence / absence</li>
<li><strong>Years</strong>: NA</li>
<li><strong>Temporal</strong>: No temporality</li>
</ul>
<div class="cell">
<div id="tbl-offshore-wind-categories" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-offshore-wind-categories-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.3: Categorization of Offshore Wind Farm Activities
</figcaption>
<div aria-describedby="tbl-offshore-wind-categories-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<colgroup>
<col style="width: 14%">
<col style="width: 85%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Category</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Existing Wind Farms</td>
<td style="text-align: left;">Areas with installed offshore wind turbines and supporting substations.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Transmission Infrastructure</td>
<td style="text-align: left;">Cables and transmission routes connecting wind farms to the grid, including cable interconnections, export cable corridors, cable landings, and inter-array cables.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Future Development Areas</td>
<td style="text-align: left;">Regions designated for offshore wind expansion, including leased areas, planning areas, Marine Hydrokinetic (MHK) zones, and project phase areas.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Environmental Monitoring</td>
<td style="text-align: left;">Devices used to collect data on environmental and ocean conditions in wind farm areas, such as ocean observing devices.</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="marine-vessel-traffic" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="marine-vessel-traffic"><span class="header-section-number">4.4</span> Marine vessel traffic</h2>
<section id="sec-shipping_threat" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="sec-shipping_threat"><span class="header-section-number">4.4.1</span> Disturbance and pollution</h3>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Atlantic scale
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This threat layer was also prepared at the scale of the whole Atlantic, <em>i.e.</em> in bounding box <code>longitude min: -97; latitude min: -54; longitude max: 49, latitude max: 66.5</code> in epsg:4326. However, the scale of the AIS data does not provide a whole Atlantic-scale characterization of ship-based pollution risk.</p>
</div>
</div>
</div>
<p>The vessel traffic threat layers quantify the monthly density of different vessel types within the area of interest, providing insight into the spatial and temporal variability of shipping, fishing, and other vessel activities and their potential environmental impacts. This analysis utilizes Automatic Identification System (AIS) data from 2023 (<a href="2_data.html#sec-shipping_ais" class="quarto-xref"><span>Section 3.4</span></a>). The following processing steps were used to create these threat layers, but refer to <a href="2_data.html#sec-shipping_ais" class="quarto-xref"><span>Section 3.4</span></a> for more information on AIS data processing:</p>
<ol type="1">
<li><strong>Data Preparation</strong>:
<ul>
<li>AIS data for ship locations and movements were ingested in parquet format and pre-processed to ensure compatibility with the study grid.</li>
<li>Auxiliary information on vessel types was included by merging with a reference dataset containing vessel classification (<code>ntype</code>).</li>
</ul></li>
<li><strong>Spatial Filtering</strong>:
<ul>
<li>Data points were filtered to retain only those within the area of interest, as defined by its bounding box.</li>
<li>Vessel movements were further processed to create continuous tracklines by connecting sequential AIS points for individual vessels.</li>
</ul></li>
<li><strong>Temporal Grouping</strong>:
<ul>
<li>Vessel tracklines were grouped by month, allowing for the calculation of monthly ship traffic densities.</li>
</ul></li>
<li><strong>Vessel Type-Specific Analysis</strong>:
<ul>
<li>Ship densities were categorized by vessel type (<code>ntype</code>), creating separate layers for different vessel classes.</li>
</ul></li>
<li><strong>Density Calculation</strong>:
<ul>
<li>Ship densities were calculated by rasterizing the trackline data onto the study grid. For each grid cell, the number of unique vessel occurrences was normalized by the number of days in the corresponding month to obtain a density assessment in number of ships per day in each grid cell.</li>
</ul></li>
<li><strong>Export</strong>:
<ul>
<li>Rasterized ship density layers were exported as geospatial files, with separate files generated for each month and vessel type.</li>
</ul></li>
</ol>
<ul>
<li><strong>Processing Script</strong>: <code>ana_shipping_intensity_density.R</code></li>
<li><strong>Output Files</strong>: Monthly ship density layers stored in <code>workspace/data/analyzed/shipping_intensity_density-1.0.0/</code>.</li>
<li><strong>Units</strong>: number of ships per day</li>
<li><strong>Years</strong>: 2023</li>
<li><strong>Temporal</strong>: Monthly</li>
</ul>
</section>
<section id="ship-based-light-pollution" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="ship-based-light-pollution"><span class="header-section-number">4.4.2</span> Ship-based light pollution</h3>
<p>The boat-based light pollution threat layers quantify the spatial and temporal distribution of artificial light emitted by boats at night. Two distinct data sources were utilized to create these layers: Automatic Identification System (AIS) data filtered for nighttime activities and VIIRS Boat Detection (VBD) data. These layers highlight areas with intense nighttime activity for a range of vessel types, reflecting potential light pollution from ship-based operations.</p>
<section id="ship-based-light-pollution-using-ais-data" class="level4" data-number="4.4.2.1">
<h4 data-number="4.4.2.1" class="anchored" data-anchor-id="ship-based-light-pollution-using-ais-data"><span class="header-section-number">4.4.2.1</span> Ship-based light pollution using AIS data</h4>
<p>This layer builds on the methods described in section <a href="#sec-shipping_threat" class="quarto-xref"><span>Section 4.4.1</span></a> but focuses specifically on nighttime vessel activities. The following key differences in processing were applied:</p>
<ol type="1">
<li><strong>Nighttime Filtering</strong>: AIS data were filtered to retain only ship positions recorded during nighttime, as determined by the <code>day_or_night</code> field in the processed AIS dataset (see <a href="2_data.html#sec-shipping_ais" class="quarto-xref"><span>Section 3.4</span></a>).</li>
<li><strong>Trackline Creation</strong>: Tracklines were constructed using only nighttime data points, maintaining the methodology described previously.</li>
<li><strong>Density Calculation</strong>: The density of nighttime shipping activities was calculated and normalized by the number of nights in each month, resulting in monthly raster layers providing the number of ships per day in each grid cell.</li>
</ol>
<ul>
<li><strong>Processing Script</strong>: <code>ana_shipping_night_light_density.R</code></li>
<li><strong>Output Files</strong>: Rasterized monthly layers stored in <code>workspace/data/analyzed/shipping_night_light_intensity_density-1.0.0/</code>.</li>
<li><strong>Units</strong>: number of ships per night per day</li>
<li><strong>Years</strong>: 2023</li>
<li><strong>Temporal</strong>: Monthly</li>
</ul>
</section>
<section id="ship-based-light-pollution-using-vbd-data" class="level4" data-number="4.4.2.2">
<h4 data-number="4.4.2.2" class="anchored" data-anchor-id="ship-based-light-pollution-using-vbd-data"><span class="header-section-number">4.4.2.2</span> Ship-based light pollution using VBD <strong>data</strong></h4>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Atlantic scale
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This threat layer was also prepared at the scale of the whole Atlantic, <em>i.e.</em> in bounding box <code>longitude min: -97; latitude min: -54; longitude max: 49, latitude max: 66.5</code> in epsg:4326.</p>
</div>
</div>
</div>
<p>The second approach utilized VIIRS Boat Detection (VBD) data (<a href="2_data.html#sec-viirs_boat_detection" class="quarto-xref"><span>Section 3.5.1</span></a>), which directly measures the radiance of lights detected from boats at night. The following steps were applied:</p>
<ol type="1">
<li><strong>Data Preparation</strong>: The VBD dataset was filtered to include only observations within the area of interest.</li>
<li><strong>Temporal Grouping</strong>: Observations were grouped by month, with radiance values aggregated for each month.</li>
<li><strong>Rasterization</strong>: Monthly radiance values were rasterized onto the study grid. Each grid cell contains the sum of radiance values for all detected boats within that cell across all years, divided by the number of years of data harvested, resulting in average total radiance per year in each grid cell.</li>
<li><strong>Masking and Export</strong>: Rasterized layers were masked to the area of interest and exported as monthly geospatial files.</li>
</ol>
<p>This layer provides a direct measurement of ship light emissions, offering a complementary perspective to the AIS-derived night lights layer.</p>
<ul>
<li><strong>Processing Script</strong>: <code>ana_ship_light_detection.R</code></li>
<li><strong>Output Files</strong>: Rasterized monthly layers stored in <code>workspace/data/**analyzed**/ship_light_detection-1.0.0/</code>.</li>
<li><strong>Units</strong>: average nanowatts per square centimeter per steradian per month (nW/cm²/sr/month)</li>
<li><strong>Years</strong>: 2020-2023</li>
<li><strong>Temporal</strong>: Monthly</li>
</ul>
</section>
</section>
</section>
<section id="coastal-light-pollution" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="coastal-light-pollution"><span class="header-section-number">4.5</span> Coastal light pollution</h2>
<p>The coastal light pollution threat layers were developed to quantify the intensity and spatial and temporal distribution of coastal light that may be affecting light-sensitive fauna in the nearshore environment. This analysis used the 2023 VIIRS Monthly Nighttime Light dataset (<a href="2_data.html#sec-viirs_nightlight" class="quarto-xref"><span>Section 3.5.3</span></a>), which provides high-resolution observations of nighttime light intensity. The data was analyzed using the following steps:</p>
<ol type="1">
<li><strong>Data Preparation</strong>: Each monthly VIIRS nighttime light raster file was resampled to the study grid.</li>
<li><strong>Coastal Masking</strong>: A coastal mask was applied to focus the analysis on regions near the coastline. The mask was created by:
<ul>
<li>Downloading and merging coastline data for Canada, the United States, and Greenland.</li>
<li>Buffering the coastlines by 1 km offshore and 5 km inland.</li>
<li>Masking the resampled nighttime light data.</li>
</ul></li>
<li><strong>Temporal Aggregation</strong>: Each monthly raster file was processed individually to extract nighttime light intensity values.</li>
<li><strong>Raster Export</strong>: Processed raster files were exported as geospatial files, with one raster generated for each month in the dataset.</li>
</ol>
<p>The night lights threat layer provides a spatially explicit representation of artificial light pollution along the coastlines, with monthly granularity.</p>
<ul>
<li><strong>Processing Script</strong>: <code>ana_night_light_monthly.R</code></li>
<li><strong>Output Files</strong>: Rasterized monthly layers stored in <code>workspace/data/analyzed/night_light_monthly-1.0.0/</code>.</li>
<li><strong>Units</strong>: average nanowatts per square centimeter per steradian per month (nW/cm²/sr/month)</li>
<li><strong>Years</strong>: January 2020 - December 2023</li>
<li><strong>Temporal</strong>: Monthly</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./2_data.html" class="pagination-link" aria-label="Data Sources Overview">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Sources Overview</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>